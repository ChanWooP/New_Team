<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user.reservation">
		<select id="getroomnum" parameterType="com.sp.user.reservation.Reservation" resultType="Integer">
			SELECT MIN(r.roomnum) roomnum
	        FROM room r 
			JOIN roomdetail rd ON r.roomnum = rd.roomnum
			JOIN hotel h ON h.hotelId=#{hotelId}
	        WHERE roomtype=#{roomtype}
	        AND roomprice=#{roomprice}
	        AND maxpeople=#{maxpeople}
	        AND roomdetails=#{roomdetails}
	        AND roomstatus=#{roomstatus}
		</select>
		
		<select id="showresdetail" parameterType="Integer" resultType="com.sp.user.reservation.Reservation">
			SELECT roomname, stair, roomtype, maxpeople, roomstatus, roomprice, rd.roomdetails 
			FROM room r
			JOIN roomdetail rd ON rd.roomnum=r.roomnum
			WHERE rd.roomnum=#{roomnum}
		</select>
		
		<select id="getReservationNum" parameterType="Integer">
			SELECT reservation_seq.CURRVAL FROM dual;
		</select>
		
		<update id="insertReservation" parameterType="map">
			INSERT ALL
				INTO reservation(reservationNum, totprice, checkmember, userName, userTel, userEmail, hotelId) VALUES(reservation_seq.nextval,#{roomprice}, 1, #{userName}, #{userTel}, #{userEmail},#{hotelId})
				INTO reserdetail(resdetailNum, peoplecount, restype, checkinday, checkoutday,price, roomnum, reservationNum) VALUES(RESERDETAIL_SEQ.nextval, 1,'카드', #{checkinday}, #{checkoutday}, #{roomprice}, #{roomnum}, reservation_seq.CURRVAL)
			SELECT * FROM DUAL	 
		</update>
		
</mapper>